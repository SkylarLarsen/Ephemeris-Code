import astropy
import astropy.timeseries
import astropy.units as u
import numpy as np
import matplotlib.pyplot as plt
import math as m
from astropy.timeseries import LombScargle

t = (52650.434545,52650.448450,52650.462420,52650.476485,52650.490443,52666.464263,52666.478719,52666.493183,52666.507710,
     52666.522176,52680.491924,52680.506645,52680.521360,52680.536053,52697.401620,52697.446816,52706.369619,52706.382492,
    52706.395445,52706.408684,52706.421824,52708.372142,52708.372257,52708.385260,52708.385375,52708.398270,52708.398385,
    52708.411459,52708.411574,52708.424498,52708.424613,52712.318286,52712.344226,52712.357133,52712.370229,52724.364441,
    52724.376739,52724.389038,52724.389639,52724.401635,52724.402237,52724.413874,52753.264881,52753.278023,52753.278135,
    52753.290448,52753.304480,52753.317076,52755.255212,52755.268071,52755.280270,52755.292432,52755.304375,52756.251487,
    52756.263435,52756.275370,52756.287313,52756.299348,52770.216147,52770.227832,52770.239453,52770.250916,52770.262761,
    52792.181762,52793.198153,52793.218150,52793.218356,52793.228164,52793.238135,52797.219308,52797.229330,52797.239303,
    52797.259232,52811.219599,52811.229361,52811.239230,52811.248990,52811.258779,52825.185901,52825.195920,52825.206158,
    53034.399473,53034.411302,53034.423154,53034.435103,53034.447106,53051.391119,53051.402719,53051.414478,53051.426082,
    53051.437723,53065.340524,53065.352071,53065.363393,53065.374785,53065.386183,53078.405154,53078.415835,53093.327107,
    53093.337484,53093.347911,53093.358290,53093.368834,53109.301583,53109.311722,53109.321934,53109.332097,53109.342144,
    53111.299062,53111.309668,53111.321073,53112.303738,53112.314571,53112.325190,53112.335917,53113.332882,53113.333280,
    53113.343911,53113.345004,53122.247834,53122.258173,53122.268394,53122.278687,53123.353939,53123.364396,53123.374718,
    53123.385077,53123.395431,53124.328457,53124.338113,53124.347380,53124.356635,53125.289994,53125.299935,53125.309884,
    53125.329822,53126.285510,53126.295352,53126.314894,53126.324630,53127.271047,53127.281077,53137.254175,53137.264244,
    53137.274148,53137.283960,53137.293674,53153.211663,53153.220946,53153.230428,53153.239426,53153.248003,53165.236028,
    53165.245834,53165.258355,53165.268163,53165.278253,53178.218988,53178.228425,53501.256254,53501.270486,53501.281710,
    53501.293854,53501.304039,53529.212596,53529.224336,53529.235729,53529.247101,53529.257995,53540.228904,53540.238497,
    53540.257881,53550.180836,53550.200612,53550.210517,53739.482598,53739.495986,53739.508906,53739.521882,53739.535010,
    53770.423810,53770.438102,53770.455277,53770.469606,53770.482518,53787.428072,53787.440882,53787.453852,53787.466863,
    53813.411188,53813.422215,53813.433356,53813.444371,53813.455408,53823.381912,53823.394656,53823.408453,53823.423709,
    53823.438703,53824.360034,53824.372332,53824.373075,53824.383321,53824.384784,53824.396047,53824.396618,53824.408634,
    53844.294879,53844.305869,53844.316810,53844.327720,53844.338736,53853.291342,53853.302148,53853.312572,53853.323086,
    53853.333501,53883.218407,53883.239024,53883.259639,53887.229182,53887.239835,53887.250529,53887.261225,53887.271938,
    53902.236645,53902.246988,53902.257438,53902.268649,53915.178880,53915.188744,53915.200141,53931.169681,53931.190552,
    53931.211364,53940.162622,53940.173195,53940.208570,54098.430944,54098.442947,54098.458128,54098.471498,54098.483711,
    54110.456680,54110.469549,54110.482217,54121.396360,54121.408563,54121.420755,54121.432951,54121.445137,54154.389924,
    54154.401459,54154.412939,54154.424491,54154.435975,54169.343192,54169.375914,54205.273311,54205.282575,54205.292413,
    54205.302143,54205.311423,54560.300119,54560.311536,54560.322936,54560.345838,54581.252795,54581.272254,54581.282033,
    54594.253937,54594.263461,54594.272887,54594.283341,54594.292763,54612.246845,54612.255389,54612.264585,54612.273210,
    54612.281910)

y = (15.969,16.036,15.99,16.027,15.675,15.945,15.97,16.001,15.829,15.586,15.586,15.701,15.761,15.879,15.917,16.036,16.024,
    15.901,15.768,15.679,15.779,15.874,15.886,15.951,15.991,15.969,16.01,15.985,16.035,15.967,15.998,15.671,15.796,15.892,
    15.948,15.786,15.807,15.917,15.764,15.996,15.792,16.033,15.885,15.687,15.947,15.814,15.915,15.986,15.882,15.979,15.998,
    15.989,15.768,16.008,15.971,15.72,15.601,15.712,16.169,16.14,16.034,15.842,15.73,15.924,15.873,16.018,15.924,16.04,
    16.031,15.958,15.86,15.633,15.713,15.669,15.674,15.837,15.892,15.912,15.916,15.724,15.681,15.651,15.573,15.726,
    15.722,15.905,15.568,15.66,15.767,15.879,15.868,15.951,15.815,15.616,15.596,15.763,15.795,15.945,15.643,15.741,
    15.822,15.855,15.895,16.033,16.031,15.873,15.7,15.803,15.911,15.967,16.01,16.043,16.106,15.942,15.8,15.757,15.823,
    15.898,15.948,15.754,15.899,15.937,15.972,15.972,16.024,16.041,16.061,16.047,16.061,16.085,16.072,16.062,15.94,
    16.034,16.03,15.984,16.022,15.971,15.584,15.601,16.115,15.782,16.05,16.06,15.825,15.683,15.683,15.761,15.783,15.911,
    15.968,16.02,15.735,15.802,15.867,15.946,15.948,16.12,16.023,16.004,15.972,15.856,15.692,15.583,15.962,16.032,
    15.884,15.694,15.657,15.76,15.819,15.911,16.002,15.918,15.687,15.964,16.008,16.007,15.885,15.586,15.854,15.962,
    15.982,15.959,15.829,16.046,16.022,16.058,15.926,15.724,15.894,15.93,15.99,15.872,15.681,15.67,15.836,15.853,
    15.992,15.668,15.75,15.763,15.872,15.928,15.955,15.961,16.007,15.964,16.024,16.075,16.006,15.866,15.893,15.962,
    16.007,15.983,16.129,16.021,16.126,15.915,15.964,15.741,15.593,15.723,15.771,15.962,15.973,16.07,16.064,16.148,
    15.893,15.699,16.014,15.947,15.718,15.845,15.912,16.11,15.867,15.92,16.016,16.002,15.88,15.89,15.98,15.947,15.612,
    15.701,15.834,15.883,15.928,15.855,15.754,15.684,15.84,15.95,15.825,15.933,15.917,15.966,16.004,16.064,16.053,
    15.969,15.927,15.804,15.615,16.056,16.14,16.009,16.058,16.139,16.199,16.132,16.058,15.964,15.912,15.75,15.779,15.768)
     
#frequency, power = LombScargle(t, y).autopower()
plt.plot(frequency, power)  


### Preparation of Data############################################################################################
### Frequency
ls = LombScargle(t, y)
frequency, power = ls.autopower(nyquist_factor=500,minimum_frequency=0.2)

### Units
period_days = 1 / frequency
period_hours = period_days * 24

best_period = period_days[np.argmax(power)]
phase = (t / best_period) % 1
print("Best period: {0:.2f} hours".format(24 * best_period))
#print(phase)
#plt.scatter(phase, y)

### Lomb-Scargle Model ############################################################################################

fig, ax = plt.subplots(figsize=(10, 3))

phase_model = np.linspace(-0.5, 1.5, 100)
best_frequency = frequency[np.argmax(power)]
mag_model = ls.model(phase_model / best_frequency, best_frequency)

for offset in [-1, 0, 1]:
    ax.errorbar(phase + offset, y, fmt='.',
                color='gray', ecolor='lightgray', capsize=0);
ax.plot(phase_model, mag_model, '-k', lw=2)
ax.set(xlim=(-0.5, 1.5),
       xlabel='phase',
       ylabel='mag')
ax.invert_yaxis()

